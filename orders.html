<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Orders</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="bg-gray-100">

  <div class="p-4 bg-white shadow flex justify-between">
    <h1 class="text-xl font-bold">My Orders</h1>
    <a href="index.html" class="px-3 py-1 border rounded">Home</a>
  </div>

  <div id="ordersList" class="p-4 space-y-4"></div>

<script>
const sb = supabase.createClient(
  "https://ytxhlihzxgftffaikumr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl0eGhsaWh6eGdmdGZmYWlrdW1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4ODAxNTgsImV4cCI6MjA3OTQ1NjE1OH0._k5hfgJwVSrbXtlRDt3ZqCYpuU1k-_OqD7M0WML4ehA"
);

async function loadOrders() {
  const user = (await sb.auth.getUser()).data?.user;

  if (!user) {
    document.getElementById("ordersList").innerHTML =
      "<p class='text-center mt-10 text-red-600'>Please login first.</p>";
    return;
  }

  const { data, error } = await sb
    .from("orders")
    .select("*")
    .eq("user_id", user.id)
    .order("created_at", { ascending: false });

  if (error) {
    console.error(error);
    return;
  }

  const container = document.getElementById("ordersList");
  container.innerHTML = "";

  data.forEach(order => {
    const box = document.createElement("div");
    box.className = "bg-white p-4 rounded shadow";

    box.innerHTML = `
      <p class="font-semibold">Order #${order.id}</p>
      <p class="text-sm text-gray-500">${new Date(order.created_at).toLocaleString()}</p>

      <p class="mt-2">Status: <strong>${order.status}</strong></p>
      <p class="mt-2">Total: <strong>₹${order.total}</strong></p>

      <p class="mt-3 font-semibold">Items:</p>
      ${order.items
        .map(item => `
          <div class="ml-4 text-sm">
            • ${item.title} × ${item.qty} — ₹${item.price * item.qty}
          </div>
        `)
        .join("")}
    `;

    container.appendChild(box);
  });
}

loadOrders();
</script>

</body>
</html>
